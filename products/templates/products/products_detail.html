{% extends "base.html" %}
{% load static %}

{% block extra_title %} | {{ product.name }} {% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/products.css' %}">
<style>
  .badge-out-of-stock {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #dc3545;
    color: white;
    padding: 5px 10px;
    font-size: 0.85rem;
    border-radius: 5px;
    z-index: 10;
  }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5 pt-5 fade-in-section">

  <!-- Product info -->
  <div class="row align-items-center position-relative">
    <div class="col-md-6 mb-4 mb-md-0 text-md-right position-relative">
      {% if product.stock == 0 %}
      <div class="badge-out-of-stock">Out of Stock</div>
      {% endif %}
      <img src="{{ product.image.url }}" class="img-fluid rounded shadow-lg product-image" alt="{{ product.name }}">
    </div>    
    <div class="col-md-6 text-light d-flex flex-column justify-content-center">
      <h2 class="display-5">{{ product.name }}</h2>
      <p class="text-muted">${{ product.price|floatformat:2 }}</p>
      <p>{{ product.description }}</p>

      {% if product.stock > 0 %}
      <form method="POST" action="{% url 'add_to_cart' product.id %}" class="mt-3">
        {% csrf_token %}
        <div class="form-group d-flex align-items-center">
          <label for="quantity" class="mr-2">Quantity</label>
          <input type="number" name="quantity" value="1" min="1" class="form-control w-25">
        </div>
        <button type="submit" class="btn btn-own-style mt-2">Add to Cart</button>
      </form>
      {% else %}
        <p class="text-danger font-weight-bold mt-3">Out of Stock</p>
      {% endif %}
    </div>
  </div>

  <!-- Intro text -->
  <hr class="my-5">
  <p class="text-muted mb-3 text-center">{{ intro_text }}</p>

  <!-- Card of the Day -->
  {% if user.is_authenticated %}
  <section class="card-of-the-day-section container my-5 text-center">
    <h2 class="mb-4 text-light">Card of the Day</h2>
    <div id="card-row" class="d-flex justify-content-center flex-wrap gap-3">
      {% for card in tarot_cards|slice:":5" %}
        <div class="flip-card" data-message="{{ card.message }}" data-name="{{ card.name }}" data-img="{{ card.image.url }}">
          <div class="flip-card-inner">
            <div class="flip-card-front">
              <img src="{% static card_back %}" alt="Card back">
            </div>
            <div class="flip-card-back">
              <img src="{{ card.image.url }}" alt="{{ card.name }}">
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

    <div id="card-reveal" class="text-center mt-4" style="display:none;">
      <h3 class="mystic-title" id="card-title"></h3>
      <p class="mystic-text" id="card-message"></p>
    </div>
  </section>
  {% else %}
  <section class="card-of-the-day-section container my-5 text-center">
    <h2 class="mb-4 text-light">Card of the Day</h2>
    <p class="text-warning">Please <a href="{% url 'account_login' %}">log in</a> to draw your card of the day.</p>
  </section>
  {% endif %}

  {% include 'includes/mystical_pick.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/products.js' %}"></script>
<script src="{% static 'js/card-of-the-day.js' %}"></script>
{% endblock %}
